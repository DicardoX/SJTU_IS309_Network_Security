# 网络安全技术 Lecture 3 哈希函数

## 1. 概念

### 1.1 语法 *Syntax*

- 哈希函数（输出长度为 $l(n)$）是一个将字符串 $x \in \{0, 1\}^*$ 作为输入，输出字符串 $H(x) \in \{0,1\}^{l(n)}$ 的多项式时间算法 $H$

<img src="./cut/截屏2021-06-14 上午10.17.30.png" alt="avatar" style="zoom:30%;" />

------

### 1.2 安全模型 *Security Model*：

- **抗碰撞性 *collision-resistant, CR***
    - 考虑如下哈希函数 $H$ 的实验，假定一个攻击者 $A$，以及长度参数 $n$
    - $HashColl_{A,H}(n)$：
        - 攻击者 $A$ 被给予哈希函数 $H$ 和长度参数 $n$
        - $A$ 输出两个字符串 $x, x' \in \{0, 1\}^*$
        - 若 $x \neq x'$ 且 $H(x) = H(x')$，该实验的输出为 $1$；否则为 $0$
    - 将攻击者 $A$ 的优势定义为 $Adv_{H, A}^{CR} = Pr(HashColl_{A,H}(n)=1)$，则我们定义**该哈希函数为抗碰撞**的条件是：**对于所有 *PPT* 攻击者 $A$，都有一个不可忽略的函数 $negl$，使得 $Adv_{H,A}^{CR} \leq negl$**
    - 注意：上述安全模型的定义表示**攻击者不能在多项式时间内以不可忽略的优势找到哈希函数 $H$ 的两个碰撞字符串**。但由于**哈希函数 $H$ 是压缩算法，其中会包含许多碰撞**。 
- **目标抗碰撞性/二级原像抗碰撞性 target-collision resistance/second-preimage**：较弱的安全性描述，**给定目标字符串**
    - 考虑如下哈希函数 $H$ 的实验，假定一个攻击者 $A$，以及长度参数 $n$
    - $HashColl_{A,H}(n)$：
        - 攻击者 $A$ 被给予哈希函数 $H$ 和目标字符串 $x \in \{0,1\}^*$
        - $A$ 输出一个字符串 $x' \in \{0,1\}^*$ 且满足 $x' \neq x$
        - 若 $H(x') = H(x)$，则该实验的输出为 $1$；否则为 $0$
    - 将攻击者 $A$ 的优势定义为 $Adv_{H, A}^{CR} = Pr(HashColl_{A,H}(n)=1)$，则我们定义**该哈希函数为目标抗碰撞**的条件是：**对于所有 *PPT* 攻击者 $A$，都有一个不可忽略的函数 $negl$，使得 $Adv_{H,A}^{CR} \leq negl$**
    - 注意，上述安全模型的定义表示**攻击者不能在多项式时间内以不可忽略的优势找到字符串 $x$ 在哈希函数 $H$ 中碰撞的另一个字符串 $x'$**

- **原像抗碰撞性 *preimage resistance***：较弱的安全性描述，**给定目标映射值**
    - 考虑如下哈希函数 $H$ 的实验，假定一个攻击者 $A$，以及长度参数 $n$
    - $HashColl_{A,H}(n)$：
        - 攻击者 $A$ 被给予哈希函数 $H$ 和目标映射值 $y \in \{0, 1\}^{l(n)}$
        - $A$ 输出一个字符串 $x \in \{0,1\}^*$
        - 若 $H(x) = y$，则该实验的输出为 $1$；否则为 $0$
    - 将攻击者 $A$ 的优势定义为 $Adv_{H, A}^{CR} = Pr(HashColl_{A,H}(n)=1)$，则我们定义**该哈希函数为原像抗碰撞**的条件是：**对于所有 *PPT* 攻击者 $A$，都有一个不可忽略的函数 $negl$，使得 $Adv_{H,A}^{CR} \leq negl$**
    - 注意，上述安全模型的定义表示**攻击者不能在多项式时间内以不可忽略的优势找到目标映射值 $y$ 在哈希函数 $H$ 中对应的原字符串 $x$**
- 定理：
    - 哈希函数：**抗碰撞性 $\Rightarrow$ 目标抗碰撞性 $\Rightarrow$ 原像抗碰撞性**
    - 证明一：抗碰撞性 $\Rightarrow$ 目标抗碰撞性
        - 我们证明逆否命题：非目标抗碰撞性 $\Rightarrow$ 非抗碰撞性
        - 若哈希函数 $H$ 不满足目标抗碰撞性，则给定攻击者哈希函数 $H$ 和目标字符串 $x \in \{0,1\}^*$，攻击者能够以不可忽略的概率找到另一个字符串 $x' \in \{0, 1\}^*$，来满足 $x \neq x'$ 且 $H(x) = H(x')$
        - 则给定该攻击者 $A$ 同样的哈希函数 $H$，同样能够首先随机确定一个 $x \in \{0, 1\}^*$， 并以不可忽略的概率找到另一个 $x' \in \{0,1\}^*$ 来满足 $x \neq x'$ 且 $H(x) = H(x')$，即不满足抗碰撞性
        - 即证
    - 证明二：目标抗碰撞性 $\Rightarrow$ 原像抗碰撞性
        - 我们证明逆否命题：非原像抗碰撞性 $\Rightarrow$ 非目标抗碰撞性
        - 若哈希函数 $H$ 不满足原像抗碰撞性，则给定攻击者哈希函数 $H$ 和目标映射值 $y \in \{0,1\}^{l(n)}$，攻击者能够以不可忽略的概率找到字符串 $x \in \{0, 1\}^*$，来满足 $y = H(x)$
        - 则给定该攻击者 $A$ 同样的哈希函数 $H$ 和目标字符串 $x \in \{0, 1\}^*$，令 $y = H(x)$，攻击者同样能够以不可忽略的概率找到另一个 $x' \in \{0, 1\}^*$ 来满足 $H(x) = y = H(x')$，（由于哈希函数是压缩函数，输入空间比输出空间大，因此必然可以找到这样的 $x'$）
        - 即证

-------



## 2. 设计

### 2.1 哈希函数的输出长度

- 采取**穷举攻击**来攻击哈希函数 $\Rightarrow$ 为保证安全性，输出长度必须足够大

- 生日问题 *Birthday Problem*：
    - 假定哈希函数的输出为 *80 bits*，则攻击者发现碰撞的概率为 $1/2$ （此时代表被攻破） 最少需要尝试多少次？
    - **长度参数为 *N bits* 的哈希函数需要 $2^{N/2}$ 次尝试来攻破**
    - **上述生日攻击 *Birthday Attack* 为消息摘要 *Message Digests* 设置了一个下限**

-----------

### 2.2 哈希函数的通用设计

- 将输入的消息 $M$ 划分成固定大小的分组 $M_i$，例如块大小为 *512 bits*。不足填满整个分组的部分使用消息长度进行填充
- 哈希函数需要**迭代使用一个压缩函数 $f$**，使用**初始向量IV**来初始化，魔术字，长度为 $l(n)$，与压缩函数的输出长度相同

<img src="./cut/截屏2021-06-14 上午11.29.07.png" alt="avatar" style="zoom:30%;" />

- 注意，哈希函数的设计通常为启发式的设计

--------

### 2.2 常用的哈希密码方案

- ***MD5***：存在弱点，可被破解
- ***SHA-1***：美国政府使用标准，存在弱点，可被破解
- ***SHA-2 (SHA 256/384/512)***：基于 *SHA-1*，更长的哈希值

------------

### 2.3 哈希函数在密码学中的应用

- **构造加密方案**：*MAC* 方案（*HMAC*，哈希运算消息认证码，基于哈希函数和密钥进行消息认证），签名方案，承诺方案
- **实际应用**：指纹、默克尔树 *Merkle tree*，密码哈希
